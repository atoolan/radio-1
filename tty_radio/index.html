<!DOCTYPE html>
<html>
    <head>
        <title>Radio</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <script type="text/javascript">
var uri = 'http://localhost:7887/api/v1.1/';
var uri_player = uri + 'player';
var uri_stations = uri + 'stations';
function doAjax(uri, method, data) {
    var request = {
        url: uri,
        type: method,
        contentType: "application/json",
        accepts: "application/json",
        cache: false,
        dataType: 'json',
        data: JSON.stringify(data),
        error: function(jqXHR) {
            console.log("ajax error " + jqXHR.status);
        }
    };
    return $.ajax(request);
}
        </script>
    </head>

    <body>
        <div class="container">
            <nav class="navbar navbar-default">
                <div class="navbar-header pull-right">
                    <a class="navbar-brand text-muted" href="#">Radio API Client</a>
                </div>
            </nav>
            <div class="jumbotron">
                <h3><div id="status-currently-streaming"></div></h3>
                <h3><div id="status-station"></div></h3>
                <h3><div id="status-stream"></div></h3>
                <h3><div id="status-song"></div></h3>
            </div>
            <div class="jumbotron">
                <h3><div id="stations-list"></div></h3>
                <!-- <h3><div id="stations-list-test"></div></h3> -->
            </div>
        </div>
        <script type="text/javascript">
// get('/api/v1.1/player')(self.status)
function getStatus() {
    doAjax(uri_player, 'GET').done(function(data) {
        if (!data.success) {
            console.log("request failure, response: " + JSON.stringify(data.resp));
            return;
        }
        console.log("Query response obj: " + JSON.stringify(data.resp));
        if (!data.resp.currently_streaming) {
            console.log("Not currently streaming");
            $('#status-currently-streaming').text("Player is not currently streaming");
        }
        else {
            console.log("Currently streaming: resp " + data.resp.station + " " + data.resp.stream);
            $('#status-currently-streaming').text('Player is streaming');
            $('#status-station').text(data.resp.station);
            $('#status-stream').text(data.resp.stream);
            $('#status-song').text(data.resp.song);
        }
    });
};  // end getStatus

// get('/api/v1.1/stations')(self.stations)
function getStations() {
    doAjax(uri_stations, 'GET').done(function(data) {
        if (!data.success) {
            console.log("request failure, response: " + JSON.stringify(data.resp));
            return;
        }
        // console.log("Query response obj: " + JSON.stringify(data.resp));
        var stations = "<ul class=\"list-group\">";
        data.resp.stations.forEach(function(station) {
            // console.log('station: ' + station)
            stations += "<li class=\"list-group-item\">" + station.ui_name + "<span class=\"badge\">" + station.streams.length + "</span>";
            if (station.streams.length > 0) {
                stations += "<ol>";
                station.streams.forEach(function(stream) {
                    stations += "<li>" + stream + "</li>";
                });
                stations += "</ol>";
            }
            stations += "</li>";
        });
        stations += "</ul>"
        $('#stations-list').html(stations);
        // var randomnumber = Math.floor(Math.random() * 100);
        // $('#stations-list-test').text(randomnumber);
    });
};  // end getStations

// $(document).ready
$(function() {
    // setInterval(function() {
    //     getStatus();
    // }, 1000);
    getStatus();
    getStations();
});

// post('/api/v1.1/player/<station>/<stream>')(self.play)
// put('/api/v1.1/player')(self.pause)
// post('/api/v1.1/player')(self.play)
// delete('/api/v1.1/player')(self.stop)
        </script>
    </body>
</html>